<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dotamox 2020 S.A.S - Conteo</title>
  <link rel="stylesheet" href="style.css">

</head>
<body>

  <header class="menu-header">
    <div class="izquierda" >
      <div class="logo">
        <img src="Dotamox.jpg" alt="Logo Dotamox">
      </div>
      <div>
        <h1 >DOTAMOX 2020 S.A.S</h1>
        <p >Hecho para durar, diseñado para destacar.</p>
      </div>
    </div>
    <div class="usuario" style="text-align:center;">
      <div class="avatar" id="avatar">A</div>
      <p id="nombre-usuario" >USUARIO</p>
    </div>
  </header>

<main>
  <div class="contenido-conteo">

    <table class="tabla-materiales">
      <thead>
        <tr>
          <th>FECHA</th>
          <th>PRODUCTO</th>
          <th>VALOR UNIDAD</th>
          <th>CANT</th>
          <th>VALOR TOTAL</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="date" class="input-tabla"></td>
          <td></td>
          <td></td>
          <td><input type="number" min="0" class="input-cant" placeholder="0"></td>
          <td></td>
        </tr>
        <tr>
          <td><input type="date" class="input-tabla"></td>
          <td></td>
          <td></td>
          <td><input type="number" min="0" class="input-cant" placeholder="0"></td>
          <td></td>
        </tr>
        <tr>
          <td><input type="date" class="input-tabla"></td>
          <td></td>
          <td></td>
          <td><input type="number" min="0" class="input-cant" placeholder="0"></td>
          <td></td>
        </tr>
        <tr>
          <td><input type="date" class="input-tabla"></td>
          <td></td>
          <td></td>
          <td><input type="number" min="0" class="input-cant" placeholder="0"></td>
          <td></td>
        </tr>
      </tbody>
    </table>

    <div class="material-lista">
      <h3>PRODUCTO</h3>
      <ul>
        <li>
          <span>CHAL METRO VRD</span>
          <button class="producto-agregar" data-producto="CHAL METRO VRD" data-valor="35000">+</button>
        </li>
        <li>
          <span>CHAL METRO NRJ</span>
          <button class="producto-agregar" data-producto="CHAL METRO NRJ" data-valor="36000">+</button>
        </li>
        <li>
          <span>CAMISA JEAN</span>
          <button class="producto-agregar" data-producto="CAMISA JEAN" data-valor="45000">+</button>
        </li>
        <li>
          <span>CAMISA DRIL</span>
          <button class="producto-agregar" data-producto="CAMISA DRIL" data-valor="40000">+</button>
        </li>
        <li>
          <span>CAMISA OXFORD</span>
          <button class="producto-agregar" data-producto="CAMISA OXFORD" data-valor="42000">+</button>
        </li>
        <li>
          <span>OVEROL DRIL</span>
          <button class="producto-agregar" data-producto="OVEROL DRIL" data-valor="55000">+</button>
        </li>
      </ul>
      <button class="boton-limpiar">LIMPIAR</button>
    </div>

  </div>
</main>

  <footer>
    <p>DOTAMOX 2020<br>NIT 9013656949</p>
  </footer>

<script>
  // SCRIPT: agregar productos desde los botones +, calcular totales y limpiar

  // Selecciono filas de la tabla (serán las filas existentes)
  const tablaCuerpo = document.querySelector(".tabla-materiales tbody");

  // Botones que agregan producto (solo los de la lista)
  const botonesProducto = document.querySelectorAll(".material-lista ul li button.producto-agregar");

  // Botón limpiar
  const botonLimpiar = document.querySelector(".boton-limpiar");

  // Función que busca la primera fila con PRODUCTO vacío
  function buscarFilaVacia() {
    const filas = Array.from(tablaCuerpo.querySelectorAll("tr"));
    return filas.find(fila => fila.cells[1].textContent.trim() === "");
  }

  // Al hacer click en un botón de producto
  botonesProducto.forEach(btn => {
    btn.addEventListener("click", () => {
      const producto = btn.dataset.producto || "";
      const valorUnidad = Number(btn.dataset.valor) || 0;

      let fila = buscarFilaVacia();

      if (!fila) {
        // Si no hay fila vacía, crear una nueva (opcional)
        fila = document.createElement("tr");
        fila.innerHTML = `
          <td><input type="date" class="input-tabla"></td>
          <td></td>
          <td></td>
          <td><input type="number" min="0" class="input-cant" placeholder="0"></td>
          <td></td>
        `;
        tablaCuerpo.appendChild(fila);
      }

      // Rellenar producto y valor
      fila.cells[1].textContent = producto;
      // Mostrar valor con separador de miles (es-CO)
      fila.cells[2].textContent = valorUnidad ? valorUnidad.toLocaleString('es-CO') : "";

      // Poner fecha actual si el input fecha está vacío
      const inputFecha = fila.querySelector('input[type="date"]');
      if (inputFecha && !inputFecha.value) {
        const hoy = new Date();
        const fechaISO = hoy.toISOString().split("T")[0];
        inputFecha.value = fechaISO;
      }

      // Obtener input de cantidad de la fila
      const inputCant = fila.querySelector(".input-cant");

      // Asegurarnos de que no se duplique el listener:
      // removemos antes y volvemos a añadir
      const nuevoInput = inputCant.cloneNode(true);
      inputCant.parentNode.replaceChild(nuevoInput, inputCant);

      // Calcular total cuando cambie la cantidad
      nuevoInput.addEventListener("input", () => {
        const cantidad = parseFloat(nuevoInput.value) || 0;
        const total = valorUnidad * cantidad;
        fila.cells[4].textContent = total ? total.toLocaleString('es-CO') : "";
      });

      // Si ya hay valor en cantidad (por ejemplo al copiar fila), calcularlo ahora
      if (nuevoInput.value) {
        const cantidadInicial = parseFloat(nuevoInput.value) || 0;
        const totalInicial = valorUnidad * cantidadInicial;
        fila.cells[4].textContent = totalInicial ? totalInicial.toLocaleString('es-CO') : "";
      }
    });
  });

  // Botón limpiar: borra todos los campos de la tabla
  botonLimpiar.addEventListener("click", () => {
    const filas = Array.from(tablaCuerpo.querySelectorAll("tr"));
    filas.forEach(fila => {
      const inputFecha = fila.querySelector('input[type="date"]');
      const inputCant = fila.querySelector('.input-cant');
      if (inputFecha) inputFecha.value = "";
      if (inputCant) inputCant.value = "";
      fila.cells[1].textContent = "";
      fila.cells[2].textContent = "";
      fila.cells[4].textContent = "";
    });
  });
</script>

</body>
</html>
